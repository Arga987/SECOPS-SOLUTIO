import { BsFillTrashFill, BsFillPencilFill } from "react-icons/bs";
import "./Table.css";
import { useState } from "react";

export const Table = ({ rows, deleteRow, editRow }) => {
  const [search, setSearch] = useState('');
  const [sortOrder, setSortOrder] = useState('asc'); 

  const handleSort = () => {
    setSortOrder((prevOrder) => (prevOrder === 'asc' ? 'desc' : 'asc'));
  };

  const sortedRows = rows.sort((a, b) => {
    const cvssA = parseFloat(a.cvss);
    const cvssB = parseFloat(b.cvss);
    if (sortOrder === 'asc') {
      return cvssA - cvssB;
    } else {
      return cvssB - cvssA;
    }
  });

  const handleDelete = (idx, cveId) => {
    const confirmDelete = window.confirm(`Do you want to delete CVE ${cveId}?`);
    if (confirmDelete) {
      deleteRow(idx);
    }
  };

  return (
    <div className="table-wrapper">
      <input
        className="search"
        onChange={(e) => setSearch(e.target.value)}
        type="search"
        placeholder="Search CVE-ID"
      />

      <table className="table">
        <thead>
          <tr>
            <th>CVE-ID</th>
            <th>Severity</th>
            <th onClick={handleSort} style={{ cursor: 'pointer' }}>
              CVSS {sortOrder === 'asc' ? '▲' : '▼'} 
            </th>
            <th className="expand">Affected Packages</th>
            <th>CWE-ID</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {sortedRows
            .filter((row) => {
              return search.toLowerCase() === ''
                ? row
                : row.cveId.toLowerCase().includes(search);
            })
            .map((row, idx) => (
              <tr key={idx}>
                <td>{row.cveId}</td>
                <td>{row.severity}</td>
                <td>{row.cvss}</td>
                <td>{row.affectedPackages}</td>
                <td>{row.cweId}</td>
                <td className="fit">
                  <span className="actions">
                    <BsFillTrashFill
                      className="delete-btn"
                      onClick={() => handleDelete(idx, row.cveId)}
                    />
                    <BsFillPencilFill
                      className="edit-btn"
                      onClick={() => editRow(idx)}
                    />
                  </span>
                </td>
              </tr>
            ))}
        </tbody>
      </table>
    </div>
  );
};
